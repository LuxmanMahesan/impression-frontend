<div class="hero">
  <div class="hero-icon">üñ®Ô∏è</div>
  <h1>D√©posez vos fichiers √† imprimer</h1>
  <p class="hero-sub">
    Entrez le code du jour remis par notre √©quipe, puis d√©posez vos documents.
    Nous nous occupons du reste.
  </p>
</div>

<div class="card depot-card">

  <!-- √âtape 1 : code -->
  <div class="etape">
    <div class="etape-header">
      <span class="etape-num">1</span>
      <span>Saisir le code du jour</span>
    </div>
    <div class="field-row">
      <input
        [(ngModel)]="code"
        placeholder="Ex : 4839"
        [disabled]="!!idDepot()"
      />
      <button (click)="demarrer()" [disabled]="!!idDepot() || !code || chargementCode()">
        {{ chargementCode() ? '‚è≥ V√©rification‚Ä¶' : 'D√©marrer' }}
      </button>
    </div>
  </div>

  @if (message() && !idDepot()) {
    <p class="message">{{ message() }}</p>
  }

  @if (idDepot()) {
    <hr />

    <!-- √âtape 2 : fichiers -->
    <div class="etape">
      <div class="etape-header">
        <span class="etape-num">2</span>
        <span>Choisir vos fichiers</span>
      </div>

      <label class="file-label" for="file-input" [class.disabled]="depotValide()">
        <span class="file-icon">üìÇ</span>
        <span>S√©lectionner des fichiers‚Ä¶</span>
        <input id="file-input" type="file" multiple (change)="surChoixFichiers($event)" [disabled]="depotValide()" />
      </label>

      @if (fichiers.length) {
        <ul class="file-list">
          @for (f of fichiers; track f.name) {
            <li>
              <span class="file-name">{{ f.name }}</span>
              <span class="file-size">{{ (f.size / 1024).toFixed(0) }} Ko</span>
            </li>
          }
        </ul>
      }
    </div>

    <hr />

    <!-- √âtape 3 : actions -->
    <div class="etape">
      <div class="etape-header">
        <span class="etape-num">3</span>
        <span>Envoyer et valider</span>
      </div>

      <div class="boutons">
        <button (click)="envoyerFichiers()" [disabled]="!fichiers.length || chargementUpload() || depotValide()">
          {{ chargementUpload() ? '‚è≥ Upload en cours‚Ä¶' : '‚¨ÜÔ∏è Uploader les fichiers' }}
        </button>
        <button (click)="valider()" class="btn-valider" [disabled]="!idDepot() || chargementValidation() || depotValide()">
          {{ chargementValidation() ? '‚è≥ Validation‚Ä¶' : depotValide() ? '‚úÖ D√©p√¥t valid√©' : '‚úÖ Valider le d√©p√¥t' }}
        </button>
      </div>
    </div>

    @if (message()) {
      <p class="message">{{ message() }}</p>
    }

    <div class="depot-id-info" [class.valide]="depotValide()">
      <span class="label-id">{{ depotValide() ? '‚úÖ D√©p√¥t valid√© ‚Äî ID' : 'ID de votre d√©p√¥t' }}</span>
      <code>{{ idDepot() }}</code>
      <p class="hint">Conservez cet identifiant et communiquez-le au magasin.</p>
    </div>
  }

</div>
