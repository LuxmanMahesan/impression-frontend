<div class="admin-layout">

  <!-- Topbar admin -->
  <div class="admin-topbar">
    <div>
      <h2>Tableau de bord Admin</h2>
      <p class="code-jour">
        Code du jour : <strong>{{ codeDuJour() }}</strong>
      </p>
    </div>
    <button class="btn-danger" (click)="deconnexion()">üö™ D√©connexion</button>
  </div>

  <hr />

  @if (message()) {
    <p class="message">{{ message() }}</p>
  }

  <!-- Liste des d√©p√¥ts -->
  <div class="card">
    <div class="card-header">
      <h3>Tous les d√©p√¥ts</h3>
      <button (click)="chargerDepots()" [disabled]="chargement()">
        {{ chargement() ? '‚è≥ Chargement‚Ä¶' : 'üîÑ Actualiser' }}
      </button>
    </div>

    @if (!depots().length && !chargement()) {
      <p class="vide">Aucun d√©p√¥t pour le moment.</p>
    }

    @if (depots().length) {
      <div class="table-wrapper">
        <table>
          <thead>
          <tr>
            <th>R√©f√©rence</th>
            <th>Statut</th>
            <th>Fichiers</th>
            <th>Cr√©√© le</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
            @for (d of depots(); track d.codePublic) {
              <tr [class.row-valide]="d.statut === 'VALIDE'" [class.row-brouillon]="d.statut === 'BROUILLON'">
                <td>
                  <code class="code-ref">{{ d.codePublic }}</code>
                </td>
                <td>
                  <span class="badge" [class.badge-valide]="d.statut === 'VALIDE'" [class.badge-brouillon]="d.statut === 'BROUILLON'">
                    {{ d.statut }}
                  </span>
                </td>
                <td class="center">{{ d.nbFichiers }}</td>
                <td>{{ d.creeLe | date:'dd/MM/yyyy HH:mm' }}</td>
                <td class="actions">
                  <button (click)="voirDetail(d.codePublic)" class="btn-sm">üìÇ Voir</button>
                  @if (confirmationSuppression() === d.codePublic) {
                    <span class="confirm-group">
                      <span class="confirm-text">Supprimer ?</span>
                      <button (click)="confirmerSuppression(d.codePublic)" class="btn-sm btn-danger">Oui</button>
                      <button (click)="annulerSuppression()" class="btn-sm btn-secondary">Non</button>
                    </span>
                  } @else {
                    <button (click)="demanderSuppression(d.codePublic)" class="btn-sm btn-danger">üóëÔ∏è</button>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>

  <!-- D√©tail du d√©p√¥t s√©lectionn√© -->
  @if (depotDetail()) {
    <div class="card depot-detail">
      <div class="detail-header">
        <div>
          <h3>D√©p√¥t <code>{{ depotDetail()!.idDepot }}</code></h3>
          <span class="badge" [class.badge-valide]="depotDetail()!.statut === 'VALIDE'">
            {{ depotDetail()!.statut }}
          </span>
        </div>
        <button (click)="fermerDetail()" class="btn-secondary btn-sm">‚úï Fermer</button>
      </div>

      <hr />

      <h4>Fichiers ({{ depotDetail()!.fichiers.length }})</h4>

      @if (!depotDetail()!.fichiers.length) {
        <p class="vide">Aucun fichier dans ce d√©p√¥t.</p>
      } @else {
        <ul class="fichier-list">
          @for (f of depotDetail()!.fichiers; track f.idFichier) {
            <li>
              <div class="fichier-info">
                <span class="fichier-nom">{{ f.nom }}</span>
                <span class="fichier-meta">{{ f.typeMime }} ¬∑ {{ (f.taille / 1024).toFixed(0) }} Ko</span>
              </div>
              <button (click)="telechargerFichier(f.idFichier, f.nom)" class="btn-sm">‚¨áÔ∏è T√©l√©charger</button>
            </li>
          }
        </ul>
      }
    </div>
  }

</div>
